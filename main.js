(()=>{"use strict";var e=document.querySelector(".search__form"),t=document.querySelector(".search__name-input");function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=t,this._cardSelector=n,this._handleCardClick=r}var t,r;return t=e,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._element.addEventListener("click",(function(){e._handleCardClick()}))}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._element.querySelector(".card__name").textContent=this._data.name,this._element.querySelector(".card__phone").textContent=this._data.phone,this._element.querySelector(".card__mail").textContent=this._data.email,this._setEventListeners(),this._element}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.append(e)}},{key:"renderFilteredItems",value:function(e){for(var t=this;this._container.firstChild;)this._container.removeChild(this._container.firstChild);e.forEach((function(e){t._renderer(e)}))}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){var n,r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){"Escape"===e.key&&i.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popupElement=document.querySelector(t),this._name=this._popupElement.querySelector(".popup__name"),this._phone=this._popupElement.querySelector(".popup__value_phone"),this._email=this._popupElement.querySelector(".popup__value_email"),this._hireDate=this._popupElement.querySelector(".popup__value_hire-date"),this._position=this._popupElement.querySelector(".popup__value_position"),this._department=this._popupElement.querySelector(".popup__value_department"),this._additional=this._popupElement.querySelector(".popup__additional")}var t,n;return t=e,(n=[{key:"open",value:function(e){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose),this._name.textContent=e.name,this._phone.textContent=e.phone,this._email.textContent=e.email,this._hireDate.textContent=e.hire_date,this._position.textContent=e.position_name,this._department.textContent=e.department,this._additional.textContent="Lorem ipsum dolor sit amet, consectetur adipiscing elit,\n      sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.\n      Адрес: ".concat(e.address)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._popupElement.addEventListener("click",(function(t){(t.target.classList.contains("popup__close")||t.target===t.currentTarget)&&e.close()}))}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){return e.ok?e.json():Promise.reject("Ошибка")},(n="_handleResponse")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this.link=t.link,this.headers=t.headers}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){return fetch(this.link,{method:"GET",headers:this.headers}).then(this._handleResponse)}},{key:"getMatch",value:function(e){return fetch("".concat(this.link,"?term=").concat(e),{method:"GET",headers:this.headers}).then(this._handleResponse)}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),u=new s(".popup");u.setEventListeners();var p=new l({link:"http://127.0.0.1:3000",headers:{"Content-Type":"application/json"}});p.getInitialCards().then((function(e){h.renderItems(e)})).catch((function(e){console.log(e)}));var h=new o({renderer:function(e){h.addItem(function(e){return new r(e,".card-template",(function(){u.open({name:e.name,phone:e.phone,email:e.email,hire_date:e.hire_date,position_name:e.position_name,department:e.department,address:e.address})})).generateCard()}(e))}},".cards__container");t.addEventListener("focus",(function(){t.addEventListener("input",(function(){p.getMatch(t.value).then((function(e){h.renderFilteredItems(e)})).catch((function(e){console.log(e)}))})),e.addEventListener("submit",(function(e){e.preventDefault(),p.getMatch(t.value).then((function(e){h.renderFilteredItems(e)})).catch((function(e){console.log(e)}))}))})),t.addEventListener("blur",(function(){t.removeEventListener("input",(function(){})),e.removeEventListener("submit",(function(e){e.preventDefault()}))}))})();